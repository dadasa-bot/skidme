local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera
local Mouse = LocalPlayer:GetMouse()

-- UI Setup
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "screenGui"
screenGui.Parent = game.CoreGui

local btn = Instance.new("TextButton")
btn.Name = "textbutton"
btn.Text = "Skidder.cc"
btn.Size = UDim2.new(0, 120, 0, 40)
btn.Position = UDim2.new(0, 30, 0, 30)
btn.TextScaled = true
btn.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
btn.TextColor3 = Color3.fromRGB(0, 0, 0)
btn.Font = Enum.Font.GothamBold
btn.Active = true
btn.Draggable = true
btn.Parent = screenGui

local btncorner = Instance.new("UICorner")
btncorner.CornerRadius = UDim.new(0, 10)
btncorner.Parent = btn

-- Camlock settings
local camlockEnabled = false
local smoothness = 0.9
local range = 1000 -- Max lock-on range
local currentTarget

-- Get closest player to mouse/camera center
local function getClosestToCursor()
	local closestPlayer = nil
	local closestDist = math.huge
	local mousePos

	-- PC uses mouse position; mobile uses screen center
	if UserInputService.TouchEnabled and not UserInputService.KeyboardEnabled then
		mousePos = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
	else
		mousePos = Vector2.new(Mouse.X, Mouse.Y)
	end

	for _, player in ipairs(Players:GetPlayers()) do
		if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
			local hrp = player.Character.HumanoidRootPart
			local screenPos, onScreen = Camera:WorldToViewportPoint(hrp.Position)
			local distanceFromCursor = (Vector2.new(screenPos.X, screenPos.Y) - mousePos).Magnitude

			local worldDistance = (Camera.CFrame.Position - hrp.Position).Magnitude

			if onScreen and distanceFromCursor < closestDist and worldDistance <= range then
				closestDist = distanceFromCursor
				closestPlayer = player
			end
		end
	end

	return closestPlayer
end

-- Lock the camera smoothly to the target
RunService.RenderStepped:Connect(function()
	if camlockEnabled and currentTarget and currentTarget.Character and currentTarget.Character:FindFirstChild("HumanoidRootPart") then
		local targetPos = currentTarget.Character.HumanoidRootPart.Position
		local camPos = Camera.CFrame.Position
		local newCFrame = CFrame.new(camPos, camPos:Lerp(targetPos, smoothness))
		Camera.CFrame = newCFrame
	end
end)

-- Toggle camlock on button click
btn.MouseButton1Click:Connect(function()
	camlockEnabled = not camlockEnabled

	if camlockEnabled then
		currentTarget = getClosestToCursor()
		if currentTarget then
			btn.Text = "Camlock: ON"
			warn("Skidder.cc - Camlock Enabled on:", currentTarget.Name)
		else
			camlockEnabled = false
			btn.Text = "Camlock: OFF"
			warn("No player near mouse/camera.")
		end
	else
		currentTarget = nil
		btn.Text = "Camlock: OFF"
		warn("Skidder.cc - Camlock Disabled")
	end
end)
